<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <div id="todo-list"></div>
    <div id="toast"></div>
    <div id="issac"></div>
    <script>
      var data = [
        {
          text: "우가우가",
          isCompleted: true,
        },
        {
          text: "우가우가우가",
          isCompleted: false,
        },
      ];

      var toastData = [
        { text: "이삭", isCompleted: true },
        { text: "토스트", isCompleted: false },
      ];

      var issacData = [
        { text: "맛있는", isCompleted: true },
        { text: "이삭토스트", isCompleted: false },
      ];

      function TodoList(selector, initialState) {
        this.state = initialState;
        this.validate = () => {
          if (this.state === null || this.state === undefined) {
            throw new Error("data가 없습니다.");
          }

          if (!Array.isArray(this.state)) {
            throw new Error("data는 배열이어야 합니다");
          }

          if (
            this.state.length > 0 &&
            !this.state.every(
              (d) =>
                d.text &&
                typeof d.text === "string" &&
                d.isCompleted !== undefined &&
                typeof d.isCompleted === "boolean"
            )
          ) {
            throw new Error("no text or no string");
          }

          if (!new.target) {
            throw new Error("new 키워드를 입력해 주세요");
          }
        };

        const $element = document.querySelector(selector);

        // DOM을 조작하는 행위는 render 함수 안에만 있어야 한다.
        this.render = () => {
          $element.innerHTML = this.state
            // object destructuring
            .map(({ text, isCompleted }) =>
              isCompleted === true
                ? `<div>${text}</div>`
                : `<div><s>${text}</s></div>`
            )
            .join("");
        };

        this.validate();
        this.render();

        this.setState = (nextState) => {
          this.state = nextState;
          this.validate();
          this.render();
        };
      }

      try {
        const todoList = new TodoList("#todo-list", data);
        const toast = new TodoList("#toast", toastData);
        const issac = new TodoList("#issac", issacData);

        setTimeout(() => {
          todoList.setState([
            {
              text: "우가우가",
              isCompleted: true,
            },
            {
              text: "우가우가우가",
              isCompleted: true,
            },
          ]);
        }, 3000);
      } catch (e) {
        alert(e.message);
      }
    </script>
  </body>
</html>
